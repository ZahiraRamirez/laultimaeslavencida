<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plan de Estudio Lic. en Relaciones P칰blicas</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fdfcfa;
      color: #333;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      color: #3e3e3e;
      font-size: 1.8rem;
      margin-bottom: 2rem;
    }
    .a침o {
      margin-bottom: 3rem;
    }
    .cuatri {
      margin-bottom: 1.5rem;
    }
    .cuatri h3 {
      background-color: #f0e6ff;
      color: #333;
      padding: 0.5rem;
      border-radius: 10px;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
    }
    .materia {
      flex: 1 1 200px;
      background: #f6f6f6;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .materia:hover {
      transform: scale(1.02);
    }
    .materia.aprobada {
      background-color: #ffd6eb;
      text-decoration: line-through;
      color: #a7446e;
    }
    .materia.aprobada::after {
      content: " 游꺚";
    }
    .materia.bloqueada {
      background-color: #e8e8e8;
      opacity: 0.6;
      cursor: not-allowed;
    }
    .tooltip {
      position: absolute;
      bottom: 105%;
      left: 50%;
      transform: translateX(-50%);
      background: #444;
      color: #fff;
      padding: 0.4rem 0.6rem;
      font-size: 0.7rem;
      border-radius: 5px;
      display: none;
      white-space: nowrap;
    }
    .materia.bloqueada:hover .tooltip {
      display: block;
    }
    .nota-input {
      display: block;
      margin-top: 0.5rem;
      font-size: 0.9rem;
    }
    #promedioBox {
      text-align: center;
      font-weight: bold;
      margin-top: 2rem;
      font-size: 1.2rem;
      background-color: #e6f7ff;
      padding: 1rem;
      border-radius: 10px;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h1>Plan de Estudio Lic. en Relaciones P칰blicas</h1>
  <div id="contenedor"></div>
  <div id="promedioBox"></div>

  <script>
    const materias = [...JSON.parse(localStorage.getItem("materiasData") || "[]")];
    if (!materias.length) {
      localStorage.setItem("materiasData", JSON.stringify([
        { codigo: "2700", nombre: "Econom칤a", cuatri: "1A1", correl: [] },
        { codigo: "2701", nombre: "Relaciones P칰blicas I", cuatri: "1A1", correl: [] },
        { codigo: "2702", nombre: "Filosof칤a", cuatri: "1A1", correl: [] },
        { codigo: "2703", nombre: "Sociolog칤a", cuatri: "1A1", correl: [] },
        { codigo: "2704", nombre: "Taller de Integraci칩n", cuatri: "1A2", correl: [] },
        { codigo: "2705", nombre: "Psicolog칤a", cuatri: "1A2", correl: [] },
        { codigo: "2706", nombre: "Teor칤a Social", cuatri: "1A2", correl: [] },
        { codigo: "2707", nombre: "Procesos Sociohist칩ricos Mundiales", cuatri: "1A2", correl: [] }
      ]));
      location.reload();
    }

    const aprobadas = new Set(JSON.parse(localStorage.getItem("materiasAprobadas") || "[]"));
    const notas = JSON.parse(localStorage.getItem("materiasNotas") || "{}");

    function renderMalla() {
      const contenedor = document.getElementById("contenedor");
      contenedor.innerHTML = "";
      const grupos = {};

      materias.forEach(m => {
        if (!grupos[m.cuatri]) grupos[m.cuatri] = [];
        grupos[m.cuatri].push(m);
      });

      Object.keys(grupos).sort().forEach(cuatri => {
        const a침o = cuatri === "OPT" ? "Optativas" : `${cuatri[0]}춿 A침o - ${cuatri[2]}춿 Cuatri`;
        const bloque = document.createElement("div");
        bloque.className = "a침o";
        bloque.innerHTML = `<div class="cuatri"><h3>${a침o}</h3><div class="grid"></div></div>`;
        const grid = bloque.querySelector(".grid");

        grupos[cuatri].forEach(m => {
          const aprobada = aprobadas.has(m.codigo);
          const div = document.createElement("div");
          div.className = "materia" + (aprobada ? " aprobada" : "");
          div.textContent = m.nombre;
          div.dataset.codigo = m.codigo;

          div.onclick = () => {
            const cod = m.codigo;
            if (aprobadas.has(cod)) {
              aprobadas.delete(cod);
              delete notas[cod];
            } else {
              aprobadas.add(cod);
              const nota = prompt("Nota obtenida en " + m.nombre);
              if (nota && !isNaN(nota)) notas[cod] = parseFloat(nota);
            }
            localStorage.setItem("materiasAprobadas", JSON.stringify([...aprobadas]));
            localStorage.setItem("materiasNotas", JSON.stringify(notas));
            renderMalla();
          };

          if (aprobada && notas[m.codigo]) {
            const notaSpan = document.createElement("span");
            notaSpan.className = "nota-input";
            notaSpan.textContent = "Nota: " + notas[m.codigo];
            div.appendChild(notaSpan);
          }

          grid.appendChild(div);
        });

        contenedor.appendChild(bloque);
      });

      calcularPromedio();
    }

    function calcularPromedio() {
      const notasGuardadas = Object.values(notas);
      const promedio = notasGuardadas.length ? (notasGuardadas.reduce((a,b) => a+b, 0) / notasGuardadas.length).toFixed(2) : "-";
      document.getElementById("promedioBox").innerText = `Promedio General: ${promedio}`;
    }

    renderMalla();
  </script>
</body>
</html>
