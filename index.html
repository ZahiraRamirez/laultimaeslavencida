const materias = [
  // 1er A침o - 1er Cuatrimestre
  {cod:'2700', nombre:'Econom칤a', correl:[], anio:1, cuatri:1},
  {cod:'2701', nombre:'Relaciones P칰blicas I', correl:[], anio:1, cuatri:1},
  {cod:'2702', nombre:'Filosof칤a', correl:[], anio:1, cuatri:1},
  {cod:'2703', nombre:'Sociolog칤a', correl:[], anio:1, cuatri:1},
  {cod:'0901', nombre:'Ingl칠s I', correl:[], anio:1, cuatri:1},
  {cod:'0911', nombre:'Computaci칩n I', correl:[], anio:1, cuatri:1},

  // 1er A침o - 2do Cuatrimestre
  {cod:'2704', nombre:'Taller de Integraci칩n', correl:[], anio:1, cuatri:2},
  {cod:'2705', nombre:'Psicolog칤a', correl:[], anio:1, cuatri:2},
  {cod:'2706', nombre:'Teor칤a Social', correl:[], anio:1, cuatri:2},
  {cod:'2707', nombre:'Procesos Sociohist칩ricos Mundiales', correl:[], anio:1, cuatri:2},
  {cod:'0902', nombre:'Ingl칠s II', correl:['0901'], anio:1, cuatri:2},
  {cod:'0912', nombre:'Computaci칩n II', correl:['0911'], anio:1, cuatri:2},

  // 2do A침o - 1er Cuatrimestre
  {cod:'2708', nombre:'Econom칤a Aplicada', correl:['2700'], anio:2, cuatri:3},
  {cod:'2709', nombre:'Relaciones P칰blicas II', correl:['2701'], anio:2, cuatri:3},
  {cod:'2710', nombre:'Teor칤a de la Comunicaci칩n I', correl:['2701'], anio:2, cuatri:3},
  {cod:'2711', nombre:'Procesos Sociohist칩ricos Argentinos', correl:['2707'], anio:2, cuatri:3},
  {cod:'0903', nombre:'Ingl칠s III', correl:['0902'], anio:2, cuatri:3},

  // 2do A침o - 2do Cuatrimestre
  {cod:'2712', nombre:'Administraci칩n General', correl:['2708'], anio:2, cuatri:4},
  {cod:'2713', nombre:'Taller de Expresi칩n Corporal', correl:[], anio:2, cuatri:4},
  {cod:'2753', nombre:'Taller de Juego y Dramatizaci칩n', correl:[], anio:2, cuatri:4},
  {cod:'2715', nombre:'Din치mica de Grupo', correl:['2710'], anio:2, cuatri:4},
  {cod:'2716', nombre:'Teor칤a de la Comunicaci칩n II', correl:['2710'], anio:2, cuatri:4},
  {cod:'0904', nombre:'Ingl칠s IV', correl:['0903'], anio:2, cuatri:4},

  // 3er A침o - 1er Cuatrimestre
  {cod:'2717', nombre:'Organizaci칩n y Estructura', correl:['2712'], anio:3, cuatri:5},
  {cod:'2718', nombre:'Publicidad y Estrategias Comunicacionales', correl:['2709','2710','2711','2712'], anio:3, cuatri:5},
  {cod:'2719', nombre:'Semi칩tica', correl:['2716'], anio:3, cuatri:5},
  {cod:'2720', nombre:'Metodolog칤a de la Investigaci칩n I', correl:[], anio:3, cuatri:5},

  // 3er A침o - 2do Cuatrimestre
  {cod:'2721', nombre:'Administraci칩n de Recursos Humanos', correl:['2717'], anio:3, cuatri:6},
  {cod:'2756', nombre:'Comunicaci칩n e Imagen Institucional', correl:['2713','2753','2717','2718','2719'], anio:3, cuatri:6},
  {cod:'2723', nombre:'Psicolog칤a Social Institucional', correl:['2715'], anio:3, cuatri:6},
  {cod:'2724', nombre:'Metodolog칤a de la Investigaci칩n II', correl:['2704'], anio:3, cuatri:6},

  // 4to A침o - 1er Cuatrimestre
  {cod:'2725', nombre:'Marketing', correl:['2721','2756','2724'], anio:4, cuatri:7},
  {cod:'2726', nombre:'Taller de Organizaci칩n de Eventos', correl:['2723'], anio:4, cuatri:7},
  {cod:'2755', nombre:'Taller de Elocuci칩n y Oratoria', correl:['2723'], anio:4, cuatri:7},
  {cod:'2728', nombre:'Investigaci칩n de Mercado', correl:['2724'], anio:4, cuatri:7},

  // 4to A침o - 2do Cuatrimestre
  {cod:'2757', nombre:'Taller de Trabajo Final', correl:['2725','2726','2755','2728'], anio:4, cuatri:8},
  {cod:'2758', nombre:'Planeamiento de Relaciones P칰blicas', correl:['2725','2726','2755','2728'], anio:4, cuatri:8},
  {cod:'2731', nombre:'Seminario de T칩picos de Avanzada', correl:['2725'], anio:4, cuatri:8},
  {cod:'2732', nombre:'Relaciones Internacionales', correl:['2725'], anio:4, cuatri:8}
];


    const estado = JSON.parse(localStorage.getItem('estadoMaterias') || '{}');

    function cumpleCorrelativas(m) {
      return m.correl.every(c => estado[c] && estado[c] >= 4);
    }

    function calcularPromedio() {
      const notas = Object.values(estado).filter(n => n >= 4);
      const promedio = notas.length ? (notas.reduce((a,b) => a + b) / notas.length).toFixed(2) : '-';
      document.getElementById('promedio').textContent = promedio;
    }

    function render() {
      const contenedor = document.getElementById('malla');
      contenedor.innerHTML = '';
      const grupos = {};
      materias.forEach(m => {
        const key = `${m.anio}춿 A침o - ${m.cuatri}춿 Cuatrimestre`;
        if (!grupos[key]) grupos[key] = [];
        grupos[key].push(m);
      });

      Object.entries(grupos).forEach(([titulo, lista], i) => {
        const div = document.createElement('div');
        div.className = 'bloque';
        div.innerHTML = `<h2>${titulo}</h2>`;
        lista.forEach(m => {
          const nota = estado[m.cod] ?? '';
          const aprobada = nota >= 4;
          const habilitada = cumpleCorrelativas(m);
          const materia = document.createElement('div');
          materia.className = 'materia';
          if (aprobada) materia.classList.add('aprobada');
          if (!habilitada && !aprobada) materia.classList.add('bloqueada');
          materia.style.background = coloresPastel[i % coloresPastel.length];

          const label = document.createElement('span');
          label.textContent = `${m.nombre}${aprobada ? ' 游꺚' : ''}`;

          const input = document.createElement('input');
          input.className = 'nota-input';
          input.type = 'number';
          input.min = 1;
          input.max = 10;
          input.value = nota;
          input.disabled = !habilitada && !aprobada;
          input.onchange = () => {
            const val = parseInt(input.value);
            if (val >= 1 && val <= 10) {
              estado[m.cod] = val;
              localStorage.setItem('estadoMaterias', JSON.stringify(estado));
              render();
              calcularPromedio();
            }
          };

          if (!habilitada && !aprobada) {
            const tooltip = document.createElement('span');
            tooltip.className = 'tooltip';
            tooltip.textContent = 'Faltan: ' + m.correl.map(c => materias.find(x => x.cod === c)?.nombre).join(', ');
            materia.appendChild(tooltip);
          }

          materia.appendChild(label);
          materia.appendChild(input);
          div.appendChild(materia);
        });
        contenedor.appendChild(div);
      });

      calcularPromedio();
    }

    render();
  </script>
</body>
</html>
