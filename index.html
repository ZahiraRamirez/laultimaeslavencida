<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Malla Curricular - Zahira</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');
    body {
      font-family: 'Montserrat', sans-serif;
      background: #f9f7f6;
      color: #444;
      margin: 1rem;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 1rem;
    }
    .promedio {
      text-align: center;
      margin-bottom: 1.2rem;
      font-size: 1.1rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }
    .bloque {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
      padding: 1rem;
    }
    .bloque h2 {
      font-size: 1rem;
      text-align: center;
      color: #6a5d7b;
      margin-bottom: 0.8rem;
    }
    .materia {
      border-radius: 8px;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      transition: 0.3s;
    }
    .materia:hover {
      opacity: 0.9;
    }
    .materia.bloqueada {
      opacity: 0.4;
      cursor: default;
    }
    .materia.aprobada {
      text-decoration: line-through;
      font-weight: bold;
    }
    .nota-input {
      width: 36px;
      font-size: 0.8rem;
      margin-left: 8px;
      border-radius: 4px;
      border: 1px solid #999;
      padding: 2px 4px;
      text-align: center;
    }
    .tooltip {
      visibility: hidden;
      background: #000a;
      color: #fff;
      font-size: 0.75rem;
      padding: 5px 8px;
      border-radius: 6px;
      position: absolute;
      top: 110%;
      left: 0;
      z-index: 10;
      width: max-content;
      max-width: 220px;
    }
    .materia.bloqueada:hover .tooltip {
      visibility: visible;
    }
    .flor {
      margin-left: 5px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular - Lic. en Relaciones P칰blicas</h1>
  <div class="promedio">Promedio general: <strong id="promedio">-</strong></div>
  <div class="grid" id="malla"></div>

  <script>
    const colores = ['#fde2e4','#cfe0e8','#f9f9c5','#e6e6fa','#d0f4de','#ffc9de','#fff1c1','#d4f0fc','#ffe3e1','#fce2db'];
    const LS_KEY = 'malla_aprobadas';
    const LS_NOTAS_KEY = 'malla_notas';

    const materias = [
      // a침o 1
      {cod:'2700', nombre:'Econom칤a', correl:[], anio:1, cuatri:1},
      {cod:'2701', nombre:'Relaciones P칰blicas I', correl:[], anio:1, cuatri:1},
      {cod:'2702', nombre:'Filosof칤a', correl:[], anio:1, cuatri:1},
      {cod:'2703', nombre:'Sociolog칤a', correl:[], anio:1, cuatri:1},
      {cod:'2704', nombre:'Taller de Integraci칩n', correl:[], anio:1, cuatri:2},
      {cod:'2705', nombre:'Psicolog칤a', correl:[], anio:1, cuatri:2},
      {cod:'2706', nombre:'Teor칤a Social', correl:[], anio:1, cuatri:2},
      {cod:'2707', nombre:'Procesos Sociohist칩ricos Mundiales', correl:[], anio:1, cuatri:2},
      {cod:'0901', nombre:'Ingl칠s I', correl:[], anio:1, cuatri:1},
      {cod:'0911', nombre:'Computaci칩n I', correl:[], anio:1, cuatri:1},
      {cod:'0902', nombre:'Ingl칠s II', correl:['0901'], anio:1, cuatri:2},
      {cod:'0912', nombre:'Computaci칩n II', correl:['0911'], anio:1, cuatri:2},

      // a침o 2
      {cod:'2708', nombre:'Econom칤a Aplicada', correl:['2700'], anio:2, cuatri:3},
      {cod:'2709', nombre:'Relaciones P칰blicas II', correl:['2701'], anio:2, cuatri:3},
      {cod:'2710', nombre:'Teor칤a de la Comunicaci칩n I', correl:['2701'], anio:2, cuatri:3},
      {cod:'2711', nombre:'Procesos Sociohist칩ricos Argentinos', correl:['2707'], anio:2, cuatri:3},
      {cod:'2712', nombre:'Administraci칩n General', correl:['2708'], anio:2, cuatri:4},
      {cod:'2713', nombre:'Taller de Expresi칩n Corporal', correl:[], anio:2, cuatri:4},
      {cod:'2753', nombre:'Taller de Juego y Dramatizaci칩n', correl:[], anio:2, cuatri:4},
      {cod:'2715', nombre:'Din치mica de Grupo', correl:['2710'], anio:2, cuatri:4},
      {cod:'2716', nombre:'Teor칤a de la Comunicaci칩n II', correl:['2710'], anio:2, cuatri:4},
      {cod:'0903', nombre:'Ingl칠s III', correl:['0902'], anio:2, cuatri:3},
      {cod:'0904', nombre:'Ingl칠s IV', correl:['0903'], anio:2, cuatri:4},

      // a침o 3
      {cod:'2717', nombre:'Organizaci칩n y Estructura', correl:['2712'], anio:3, cuatri:5},
      {cod:'2718', nombre:'Publicidad y Estrategias Comunicacionales', correl:['2709','2710','2711','2712'], anio:3, cuatri:5},
      {cod:'2719', nombre:'Semi칩tica', correl:['2716'], anio:3, cuatri:5},
      {cod:'2720', nombre:'Metodolog칤a de la Investigaci칩n I', correl:[], anio:3, cuatri:5},
      {cod:'2721', nombre:'Administraci칩n de Recursos Humanos', correl:['2717'], anio:3, cuatri:6},
      {cod:'2756', nombre:'Comunicaci칩n e Imagen Institucional', correl:['2713','2753','2717','2718','2719'], anio:3, cuatri:6},
      {cod:'2723', nombre:'Psicolog칤a Social Institucional', correl:['2715'], anio:3, cuatri:6},
      {cod:'2724', nombre:'Metodolog칤a de la Investigaci칩n II', correl:['2704'], anio:3, cuatri:6},

      // a침o 4
      {cod:'2725', nombre:'Marketing', correl:['2721','2756','2724'], anio:4, cuatri:7},
      {cod:'2726', nombre:'Taller de Organizaci칩n de Eventos', correl:['2723'], anio:4, cuatri:7},
      {cod:'2755', nombre:'Taller de Elocuci칩n y Oratoria', correl:['2723'], anio:4, cuatri:7},
      {cod:'2728', nombre:'Investigaci칩n de Mercado', correl:['2724'], anio:4, cuatri:7},
      {cod:'2757', nombre:'Taller de Trabajo Final', correl:['2725','2726','2755','2728'], anio:4, cuatri:8},
      {cod:'2758', nombre:'Planeamiento de Relaciones P칰blicas', correl:['2725','2726','2755','2728'], anio:4, cuatri:8},
      {cod:'2731', nombre:'Seminario de T칩picos de Avanzada', correl:['2725'], anio:4, cuatri:8},
      {cod:'2732', nombre:'Relaciones Internacionales', correl:['2725'], anio:4, cuatri:8},
    ];

    const aprobadas = JSON.parse(localStorage.getItem(LS_KEY)) || {};
    const notas = JSON.parse(localStorage.getItem(LS_NOTAS_KEY)) || {};
    const contenedor = document.getElementById("malla");

    function desbloqueada(m) {
      return m.correl.every(c => aprobadas[c]);
    }

    function render() {
      contenedor.innerHTML = '';
      for (let a = 1; a <= 4; a++) {
        for (let c = 1; c <= 2; c++) {
          const bloque = document.createElement('div');
          bloque.className = 'bloque';
          bloque.innerHTML = `<h2>A침o ${a} - Cuatr. ${((a-1)*2 + c)}</h2>`;
          materias.filter(m => m.anio === a && m.cuatri === ((a-1)*2 + c)).forEach(m => {
            const div = document.createElement('div');
            div.className = 'materia';
            div.style.background = colores[Math.floor(Math.random() * colores.length)];

            const desbloq = desbloqueada(m);
            if (!desbloq) {
              div.classList.add('bloqueada');
              const tooltip = document.createElement('div');
              tooltip.className = 'tooltip';
              const nombres = m.correl.map(c => {
                const ref = materias.find(mat => mat.cod === c);
                return ref ? ref.nombre : c;
              });
              tooltip.innerText = 'Falta: ' + nombres.join(', ');
              div.appendChild(tooltip);
            }

            if (aprobadas[m.cod]) {
              div.classList.add('aprobada');
              div.innerHTML += '游꺚';
            }

            div.insertAdjacentText('afterbegin', m.nombre);

            const input = document.createElement('input');
            input.className = 'nota-input';
            input.type = 'number';
            input.min = 0;
            input.max = 10;
            input.value = notas[m.cod] || '';
            input.title = "Nota 4-10";
            input.addEventListener('click', e => e.stopPropagation());
            input.addEventListener('change', () => {
              let val = parseFloat(input.value);
              if (isNaN(val) || val < 0 || val > 10) {
                alert("Nota inv치lida.");
                input.value = notas[m.cod] || '';
              } else {
                notas[m.cod] = val;
                localStorage.setItem(LS_NOTAS_KEY, JSON.stringify(notas));
                calcularPromedio();
              }
            });

            div.appendChild(input);

            if (desbloq) {
              div.addEventListener('click', () => {
                let notaVal = parseFloat(input.value);
                if (notaVal >= 4 && notaVal <= 10) {
                  aprobadas[m.cod] = true;
                  localStorage.setItem(LS_KEY, JSON.stringify(aprobadas));
                } else {
                  alert("Necesit치s nota de 4 a 10 para aprobar.");
                  return;
                }
                render();
                calcularPromedio();
              });
            }

            bloque.appendChild(div);
          });
          contenedor.appendChild(bloque);
        }
      }
    }

    function calcularPromedio() {
      let total = 0;
      let count = 0;
      for (let cod in aprobadas) {
        let val = parseFloat(notas[cod]);
        if (!isNaN(val)) {
          total += val;
          count++;
        }
      }
      document.getElementById("promedio").innerText = count ? (total / count).toFixed(2) : '-';
    }

    render();
    calcularPromedio();
  </script>
</body>
</html>
